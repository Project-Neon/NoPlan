<!DOCTYPE html>
<html>
<head>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>		
	<title>Server</title>
</head>
	<body>
		<h1>Hello!</h1>

		<canvas id="field_canvas" width="1200" style="width:75%;align-items: center;">

		</canvas>

		<form action="">
	      <button>Pause Game</button>
	    </form>	

		<script type="text/javascript">
			var canvas = document.getElementById("field_canvas");
			var ctx = canvas.getContext("2d");
			
			var canvasH = 1300;
			var canvasW = 1700;

			var width = canvas.width;
			var scale = width / canvasW;
			var height = scale * canvasH;
			canvas.height = height;

			var xCenter = width / 2;
			var yCenter = height / 2;
			$(function () {
					var socket = io();
					
					$('form').submit(function(){
						socket.emit('toggle game', '');
						return false;
					});

					socket.on('detection', function(msg){
						detection_json = msg
						drawField(ctx, canvas.width, canvas.height);
						// start ball drawing
						ball_pos = [
							detection_json.balls[0].x,
							detection_json.balls[0].y
						]
						ball_pos = translatePosition(ball_pos[0], ball_pos[1])
						drawBall(ctx, ball_pos.x, ball_pos.y)
						// end ball drawing

						// start player drawing
						detection_json.robots_blue.forEach(function(robot) {
							player_pos = translatePosition(robot.x, robot.y)
							tag = robot.robot_id
							angle = robot.orientation
							drawPlayer(ctx, player_pos.x, player_pos.y, angle, 'blue', 1)
						});

						detection_json.robots_yellow.forEach(function(robot) {
							player_pos = translatePosition(robot.x, robot.y)
							tag = robot.robot_id
							angle = robot.orientation
							drawPlayer(ctx, player_pos.x, player_pos.y, angle, 'yellow', 1)
						});
						// end player drawing
					});
				});
			drawField(ctx, canvas.width, canvas.height);

			function drawField(ctx, w, h) {
				// var widthP = 1125;
				// var heightP = 975;

				// Render field
				ctx.fillStyle = "#333";
				ctx.fillRect(0, 0, width, height);

				// Draw Field center lines and circle
				ctx.beginPath();
				ctx.fillStyle = "#FFF";
				ctx.arc(xCenter, yCenter, 1, 0, Math.PI * 2, false);
				ctx.fill();
				var widthP = w;
				var heightP = h;

				var widthCm = 170;
				var heightCm = 130;

				var ratioPxCm = widthP/widthCm;

				var xCenter = widthP / 2;
				var yCenter = heightP / 2;

				var goalH=40*ratioPxCm;


				ctx.beginPath();
				ctx.strokeStyle="white";
				ctx.lineWidth=0.5*ratioPxCm;
				ctx.rect(xCenter-(75*ratioPxCm),0,150*ratioPxCm,130*ratioPxCm);
				ctx.stroke();

				ctx.beginPath();
				ctx.arc(xCenter,yCenter,(20*ratioPxCm),0,2*Math.PI);
				ctx.stroke();


				//Left Goal Area
				ctx.beginPath();
				ctx.strokeStyle="white";
				ctx.lineWidth=0.5*ratioPxCm;
				ctx.fillStyle='#333'
				ctx.fillRect(0,yCenter-(20*ratioPxCm),10.3*ratioPxCm,40*ratioPxCm);
				ctx.stroke();

				//Right Goal Area
				ctx.beginPath();
				ctx.strokeStyle="white";
				ctx.lineWidth=0.5*ratioPxCm;
				ctx.fillStyle='#333'
				ctx.fillRect(widthP-(10.3*ratioPxCm),yCenter-(20*ratioPxCm),10*ratioPxCm,40*ratioPxCm);
				ctx.stroke();

				//Draw Left Goal Lines
				ctx.beginPath();
				ctx.strokeStyle="white";
				ctx.lineWidth=0.5*ratioPxCm;
				ctx.fillStyle='#333'
				ctx.moveTo(xCenter+(170*ratioPxCm),yCenter+(20*ratioPxCm));
				ctx.lineTo(xCenter+(170*ratioPxCm)-(10*ratioPxCm),yCenter+(20*ratioPxCm));
				ctx.lineTo(xCenter+(170*ratioPxCm)-(10*ratioPxCm),yCenter+(20*ratioPxCm));
				ctx.lineTo(xCenter+(170*ratioPxCm),(yCenter+(35*ratioPxCm))-(70*ratioPxCm));

				// Draw Central Line'
				ctx.moveTo(xCenter,0);
				ctx.lineTo(xCenter,heightP);

				//Draw Right side goal area
				ctx.moveTo(xCenter+(75*ratioPxCm),yCenter+(35*ratioPxCm));
				ctx.lineTo(xCenter+(60*ratioPxCm),yCenter+(35*ratioPxCm));
				ctx.lineTo(xCenter+(60*ratioPxCm),(yCenter+(35*ratioPxCm))-(70*ratioPxCm));
				ctx.lineTo(xCenter+(75*ratioPxCm),(yCenter+(35*ratioPxCm))-(70*ratioPxCm));

				//Draw Left side goal area
				ctx.moveTo(xCenter-(75*ratioPxCm),yCenter+(35*ratioPxCm));
				ctx.lineTo(xCenter-(60*ratioPxCm),yCenter+(35*ratioPxCm));
				ctx.lineTo(xCenter-(60*ratioPxCm),(yCenter+(35*ratioPxCm))-(70*ratioPxCm));
				ctx.lineTo(xCenter-(75*ratioPxCm),(yCenter+(35*ratioPxCm))-(70*ratioPxCm));


				//Draw bottom-left +
				ctx.moveTo(xCenter-(37.5*ratioPxCm),(yCenter)+(44*ratioPxCm));
				ctx.lineTo(xCenter-(37.5*ratioPxCm),(yCenter)+(36*ratioPxCm));
				ctx.moveTo(xCenter-(41.5*ratioPxCm),(yCenter)+(40*ratioPxCm));
				ctx.lineTo(xCenter-(33.5*ratioPxCm),(yCenter)+(40*ratioPxCm));
				//Draw center-left +
				ctx.moveTo((xCenter)-37.5*ratioPxCm,(yCenter)-(4*ratioPxCm));
				ctx.lineTo((xCenter)-37.5*ratioPxCm,(yCenter)+(4*ratioPxCm));
				ctx.moveTo((xCenter)-41.5*ratioPxCm,yCenter);
				ctx.lineTo((xCenter)-33.5*ratioPxCm,yCenter);
				//Draw top-left +
				ctx.moveTo((xCenter)-37.5*ratioPxCm,(yCenter)-(44*ratioPxCm));
				ctx.lineTo((xCenter)-37.5*ratioPxCm,(yCenter)-(36*ratioPxCm));
				ctx.moveTo((xCenter)-41.5*ratioPxCm,(yCenter)-(40*ratioPxCm));
				ctx.lineTo((xCenter)-33.5*ratioPxCm,(yCenter)-(40*ratioPxCm));


				//Draw bottom-right +
				ctx.moveTo(xCenter+(37.5*ratioPxCm),(yCenter)+(44*ratioPxCm));
				ctx.lineTo(xCenter+(37.5*ratioPxCm),(yCenter)+(36*ratioPxCm));
				ctx.moveTo(xCenter+(41.5*ratioPxCm),(yCenter)+(40*ratioPxCm));
				ctx.lineTo(xCenter+(33.5*ratioPxCm),(yCenter)+(40*ratioPxCm));
				//Draw center-right +
				ctx.moveTo((xCenter)+37.5*ratioPxCm,(yCenter)-(4*ratioPxCm));
				ctx.lineTo((xCenter)+37.5*ratioPxCm,(yCenter)+(4*ratioPxCm));
				ctx.moveTo((xCenter)+41.5*ratioPxCm,yCenter);
				ctx.lineTo((xCenter)+33.5*ratioPxCm,yCenter);
				//Draw top-right +
				ctx.moveTo((xCenter)+37.5*ratioPxCm,(yCenter)-(44*ratioPxCm));
				ctx.lineTo((xCenter)+37.5*ratioPxCm,(yCenter)-(36*ratioPxCm));
				ctx.moveTo((xCenter)+41.5*ratioPxCm,(yCenter)-(40*ratioPxCm));
				ctx.lineTo((xCenter)+33.5*ratioPxCm,(yCenter)-(40*ratioPxCm));

				ctx.strokeStyle="white";
				ctx.lineWidth=0.5*ratioPxCm;
				ctx.stroke();
			}

			function translatePosition(pos_x, pos_y) {
				x = pos_x * scale + width/2
				y = pos_y * scale + height/2
				return {'x': x, 'y': y}
			}

			function drawBall(ctx, pos_x, pos_y) {
				ctx.beginPath();
				ctx.fillStyle = 'rgb(255, 165, 0)';
				ctx.arc(pos_x,pos_y,25, 0, 2*Math.PI);
				ctx.stroke();
			}

			function drawPlayer(ctx, pos_x, pos_y, angle, color, number_tag) {
				ctx.beginPath();
				ctx.rect(pos_x, pos_y, 70, 70);
				ctx.fillStyle = color;
				ctx.fill();
				ctx.lineWidth = 7;
				ctx.strokeStyle = 'black';
				ctx.stroke();
			}
		</script>
	</body>
</html>